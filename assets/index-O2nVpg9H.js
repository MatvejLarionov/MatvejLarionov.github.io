var $=Object.defineProperty;var U=(t,e,r)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var h=(t,e,r)=>(U(t,typeof e!="symbol"?e+"":e,r),r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const g of s.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();class a{constructor(e,r){this.x=e,this.y=r}getIndex(e){return e*this.y+this.x}ConvertToNewPoint(e,r){const o=r.x-e[0].x,i=r.y-e[0].y;return e.map(s=>new a(s.x+o,s.y+i))}}class l{constructor(){this.arr=[new a(1,1)]}turn_clockwise(e){const r=e[0];let o=0,i=0;for(let s=1;s<e.length;s++)o=r.x-e[s].x,i=r.y-e[s].y,e[s].x=r.x+i,e[s].y=r.y-o;return e}turn_counterclockwise(e){const r=e[0];let o=0,i=0;for(let s=1;s<e.length;s++)o=r.x-e[s].x,i=r.y-e[s].y,e[s].x=r.x-i,e[s].y=r.y+o;return e}}class O extends l{constructor(){super(...arguments);h(this,"arr",this.arr.concat([new a(0,1),new a(2,1),new a(1,2)]))}}class P extends l{constructor(){super(...arguments);h(this,"arr",this.arr.concat([new a(0,0),new a(1,0),new a(2,1)]))}}class J extends l{constructor(){super(...arguments);h(this,"arr",this.arr.concat([new a(0,1),new a(1,0),new a(2,0)]))}}class A extends l{constructor(){super(...arguments);h(this,"arr",this.arr.concat([new a(1,0),new a(1,2)]))}}class K extends l{}class j extends l{constructor(){super(...arguments);h(this,"arr",this.arr.concat([new a(1,0),new a(1,2),new a(2,2)]))}}class q extends l{constructor(){super(...arguments);h(this,"arr",this.arr.concat([new a(1,0),new a(1,2),new a(0,2)]))}}class H{constructor(e,r,o){this.field=e,this.n=r,this.m=o}getSize(){return n*m}}class z{constructor(e,r,o){this.field=e,this.figure=r,this.color=o,this.realyColor=r.arr}func(e){return e.x>=0&&e.y>=0&&e.x<this.field.n&&e.y<this.field.m}setFigureOnField(e){this.realyColor=new a().ConvertToNewPoint(this.realyColor,e),this.realyColor.filter(r=>this.func(r)).map(r=>{this.field.field[r.getIndex(this.field.n)].style.background=this.color})}deleteFigure(){this.realyColor.filter(e=>this.func(e)).map(e=>{this.field.field[e.getIndex(this.field.n)].style.background="white"})}movFigure(e){this.deleteFigure(),this.setFigureOnField(e)}turn_clockwise(){this.deleteFigure(),this.realyColor=new l().turn_clockwise(this.realyColor),this.realyColor.filter(e=>this.func(e)).map(e=>{this.field.field[e.getIndex(this.field.n)].style.background=this.color})}turn_counterclockwise(){this.deleteFigure(),this.realyColor=new l().turn_counterclockwise(this.realyColor),this.realyColor.filter(e=>this.func(e)).map(e=>{this.field.field[e.getIndex(this.field.n)].style.background=this.color})}canSetFigureOnField(e,r=this.realyColor){const o=new a().ConvertToNewPoint(r,e);for(let i=0;i<o.length;i++)if(o[i].x<0||o[i].x>=this.field.n||o[i].y>=this.field.m)return!1;return o.filter(i=>i.y>=0).findIndex(i=>JSON.stringify(this.realyColor).includes(JSON.stringify(i))?!1:this.field.field[i.getIndex(this.field.n)].style.background!=="white")===-1}canTurn_clockwise(){return this.canSetFigureOnField(this.realyColor[0],new l().turn_clockwise(Object.values(JSON.parse(JSON.stringify(this.realyColor)))))}canTurn_counterclockwise(){return this.canSetFigureOnField(this.realyColor[0],new l().turn_counterclockwise(Object.values(JSON.parse(JSON.stringify(this.realyColor)))))}}const C="http://localhost:3000",b=async({baseUrl:t,method:e,pathname:r,id:o,body:i})=>{const s=`${t}/${r}/${o||""}`,g={method:e||"GET"};return(e==="POST"||e==="PUT"||e==="PATCH")&&(g.body=JSON.stringify(i)),await(await fetch(s,g)).json()},W=t=>b({baseUrl:C,pathname:"users",body:t,method:"PATCH",id:t.id}),X=t=>b({baseUrl:C,id:t,pathname:"users"}).then(e=>e.record);function T(t){t.code==="KeyA"&&this.tryMovLeft(),t.code==="KeyD"&&this.tryMovRight(),t.code==="KeyW"&&this.tryTurnClockwise(),t.code==="KeyS"&&this.tryTurnCounterclockwise()}function _(t){t.target.id==="btnLeft"&&this.tryMovLeft(),t.target.id==="btnRight"&&this.tryMovRight(),t.target.id==="btnTurnClockwise"&&this.tryTurnClockwise(),t.target.id==="btnTurnCounterclockwise"&&this.tryTurnCounterclockwise()}class Y{constructor(e,r){this.figContr=e,this.isContinue=!0,this.count=0,this.userData={record:null,id:r},X(r).then(o=>{this.userData.record=o,document.getElementById("record").innerText=this.userData.record}),T=T.bind(this),_=_.bind(this)}setNewFigure(){const e=["red","blue","orange","rgb(158, 158, 72)","green","purple"],r=[new O,new P,new J,new A,new K,new j,new q];this.figContr.realyColor=r[Math.round(Math.random()*100)%r.length].arr,this.figContr.color=e[Math.round(Math.random()*100)%e.length];let o=Math.round(Math.random()*100)%this.figContr.field.n;for(;!this.figContr.canSetFigureOnField(new a(o,-1));)o=Math.round(Math.random()*100)%this.figContr.field.n;this.figContr.setFigureOnField(new a(o,-1))}movDown(){this.figContr.movFigure(new a(this.figContr.realyColor[0].x,this.figContr.realyColor[0].y+1))}canMovDown(){return this.figContr.canSetFigureOnField(new a(this.figContr.realyColor[0].x,this.figContr.realyColor[0].y+1))}tryMovRight(){this.figContr.canSetFigureOnField(new a(this.figContr.realyColor[0].x+1,this.figContr.realyColor[0].y))&&this.figContr.movFigure(new a(this.figContr.realyColor[0].x+1,this.figContr.realyColor[0].y))}tryMovLeft(){this.figContr.canSetFigureOnField(new a(this.figContr.realyColor[0].x-1,this.figContr.realyColor[0].y))&&this.figContr.movFigure(new a(this.figContr.realyColor[0].x-1,this.figContr.realyColor[0].y))}tryTurnClockwise(){this.figContr.canTurn_clockwise()&&this.figContr.turn_clockwise(this.figContr.realyColor)}tryTurnCounterclockwise(){this.figContr.canTurn_counterclockwise()&&this.figContr.turn_counterclockwise(this.figContr.realyColor)}findFilledRows(){const e=[];for(let r=0;r<this.figContr.field.m;r++)Object.values(this.figContr.field.field).slice(new a(0,r).getIndex(this.figContr.field.n),new a(this.figContr.field.n,r).getIndex(this.figContr.field.n)).findIndex(i=>i.style.background==="white")===-1&&e.push(r);return e}deleteRows(){const e=this.figContr.field.n;this.figContr.field.m;const r=this.figContr.field.field;this.count+=10*this.findFilledRows().map(o=>{for(let i=new a(e-1,o).getIndex(e);i-e>=0;i--)r[i].style.background=r[i-e].style.background}).length,document.getElementById("count").innerText=this.count,this.count>this.userData.record&&(this.userData.record=this.count,document.getElementById("record").innerText=this.count,W(this.userData))}isGameOver(){return this.figContr.realyColor.findIndex(e=>e.y<0)!==-1}movingDown(){this.setNewFigure();const r=setInterval(()=>{if(!this.isContinue){clearInterval(r),this.stopGame();return}if(this.canMovDown())this.movDown();else{if(clearInterval(r),this.deleteRows(),this.isGameOver()){this.stopGame();return}this.movingDown()}},150)}startGame(){this.isContinue=!0,this.movingDown(),document.addEventListener("keydown",T),document.addEventListener("click",_)}stopGame(){this.isContinue=!1,document.removeEventListener("keydown",T),document.removeEventListener("click",_)}deleteGame(){this.stopGame(),this.count=0,count.innerText=this.count,Object.values(this.figContr.field.field).forEach(e=>{e.style.background="white"})}}const Z=(t,e,r)=>new z(new H(t,e,r),new O,"red"),c=({tagName:t,className:e,id:r,text:o})=>{const i=document.createElement(t);return i.classList.add(e),r&&(i.id=r),o&&(i.innerText=o),i},d=({text:t,className:e,id:r,callBack:o})=>{const i=document.createElement("button");return t&&(i.innerText=t),e&&i.classList.add(e),r&&(i.id=r),o&&i.addEventListener("click",o),i};let p=null;const Q=()=>{p.stopGame()};let y=null;const V=()=>{p.deleteGame(),y&&(clearTimeout(y),y=null),y||(y=setTimeout(()=>{p.startGame()},200))},ee=()=>{p.startGame()},te=()=>{const t=c({tagName:"div",className:"gameContainer",id:"gameContainer"}),e=c({tagName:"div",className:"game",id:"game"}),r=c({tagName:"p",className:"count",id:"count"}),o=c({tagName:"p",className:"record",id:"record"}),i=c({tagName:"nav",className:"nav",id:"nav"}),s=d({text:"стоп",className:"btnStop",id:"btnStop",callBack:Q}),g=d({text:"Заново",className:"btnRestart",id:"btnRestart",callBack:V});i.append(s,g);const S=c({tagName:"nav",className:"navControl",id:"navControl"}),R=d({className:"btnRight",id:"btnRight"}),B=d({className:"btnLeft",id:"btnLeft"}),M=d({className:"btnTurnClockwise",id:"btnTurnClockwise"}),D=d({className:"btnTurnCounterclockwise",id:"btnTurnCounterclockwise"});S.append(B,D,M,R),t.append(e,r,o,i,S),document.querySelector(":root").style.setProperty("--n",15),document.querySelector(":root").style.setProperty("--m",23);const u=15,x=23,G=v=>{const E=document.createElement("div");E.style.background=v,E.className="cell",e.append(E)};for(let v=0;v<u*x;v++)G("white");return e.getElementsByTagName("div")[0].style.borderTopLeftRadius="15px",e.getElementsByTagName("div")[new a(u-1,0).getIndex(u)].style.borderTopRightRadius="15px",e.getElementsByTagName("div")[new a(u-1,x-1).getIndex(u)].style.borderBottomRightRadius="15px",e.getElementsByTagName("div")[new a(0,x-1).getIndex(u)].style.borderBottomLeftRadius="15px",p=new Y(Z(e.getElementsByTagName("div"),u,x),window.location.pathname.split("/").at(-1)),r.innerText=0,o.innerText=0,t},ne="_container_tymni_9",re="_regContainer_tymni_35",ie="_btnSend_tymni_51",oe="_error_tymni_81",N={container:ne,regContainer:re,btnSend:ie,error:oe},k=({type:t,labelTitle:e,callBack:r})=>{const o=document.createElement("input"),i=document.createElement("label");return o.setAttribute("type",t),r&&o.addEventListener("change",s=>r(s.target.value)),i.innerText=e,i.append(o),i},se=t=>b({baseUrl:C,body:t,pathname:"users",method:"POST"}),L=()=>b({baseUrl:C,pathname:"users"}),ae=async t=>await L().then(e=>e.findIndex(r=>t===r.login)!==-1),f={login:"",password:"",record:0,setLogin(t){this.login=t},setPassword(t){this.password=t},toEmpty(){this.login="",this.password=""},isEmpty(){return!(this.login&&this.password)}},ce=t=>{f.setLogin(t)},le=t=>{f.setPassword(t)},de=t=>{t.preventDefault(),ae(f.login).then(e=>{const r=`${e?"Такой пользователь уже существует.":""}${f.isEmpty()?"Заполните поля.":""}`;r?document.getElementById("error").innerText=r:se(f).then(o=>{document.getElementById("regContainer").reset(),document.getElementById("error").innerText="",window.location.pathname=`/game/${o.id}`,f.toEmpty()})})},ge=()=>{const t=c({tagName:"div",className:N.container,id:"container"}),e=c({tagName:"form",className:N.regContainer,id:"regContainer"}),r=k({labelTitle:"login",type:"text",callBack:ce}),o=k({labelTitle:"password",type:"password",callBack:le}),i=d({text:"отправить",className:N.btnSend,id:"btnSend",callBack:de}),s=c({tagName:"p",className:N.error,id:"error"});return e.append(r,o,i),t.append(e,s),t},ue="_container_ng3it_9",he="_signInContainer_ng3it_33",fe="_btnSend_ng3it_49",me="_error_ng3it_81",I={container:ue,signInContainer:he,btnSend:fe,error:me},F={login:"",password:"",record:0,setLogin(t){this.login=t},setPassword(t){this.password=t},toEmpty(){this.login="",this.password=""},isEmpty(){return!(this.login&&this.password)}},ye=t=>{F.setLogin(t)},we=t=>{F.setPassword(t)},pe=t=>{t.preventDefault(),L().then(e=>{const r=e.findIndex(o=>o.login===F.login&&o.password===F.password);r!==-1?(document.getElementById("signInContainer").reset(),window.location.pathname=`/game/${e[r].id}`):document.getElementById("error").innerText="Неправильный логин или пароль"})},Ce=()=>{const t=c({tagName:"div",className:I.container,id:"container"}),e=c({tagName:"form",className:I.signInContainer,id:"signInContainer"}),r=k({labelTitle:"login",type:"text",callBack:ye}),o=k({labelTitle:"password",type:"password",callBack:we}),i=d({text:"отправить",className:I.btnSend,id:"btnSend",callBack:pe}),s=c({tagName:"p",className:I.error,id:"error"});return e.append(r,o,i),t.append(e,s),t},be=t=>b({baseUrl:C,pathname:"texts",id:t}),xe=()=>be("title"),ve="_container_1vhdu_1",Te="_nav_1vhdu_21",_e="_btnSignIn_1vhdu_33",Ne="_btnRegistration_1vhdu_39",Ie="_titleText_1vhdu_45",w={container:ve,nav:Te,btnSignIn:_e,btnRegistration:Ne,titleText:Ie},ke=()=>{window.location.pathname="/signIn"},Fe=()=>{window.location.pathname="/registration"},Se=()=>{const t=c({tagName:"div",className:w.container,id:"titleContainer"}),e=c({tagName:"nav",className:w.nav,id:"nav"}),r=d({text:"sign in",className:w.btnSignIn,id:"btnSignIn",callBack:ke}),o=d({text:"registration",className:w.btnRegistration,id:"btnRegistration",callBack:Fe}),i=c({tagName:"p",className:w.titleText,id:"titleText"});return xe().then(s=>{i.innerText=s.text}),e.append(r,o),t.append(i,e),t},Ee=()=>{if(window.location.pathname==="/")return Se();if(window.location.pathname==="/signIn")return Ce();if(window.location.pathname==="/registration")return ge();if(window.location.pathname.includes("/game")){const t=te();return ee(),t}},Oe=document.getElementById("app");Oe.append(Ee());
